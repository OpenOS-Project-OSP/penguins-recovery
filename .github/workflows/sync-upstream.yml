name: Sync from upstream

on:
  schedule:
    - cron: '0 0 * * *' # Daily at midnight UTC
  workflow_dispatch: # Allow manual trigger

jobs:
  sync:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Sync upstream
        run: |
          git remote add upstream https://github.com/Interested-Deving-1896/penguins-recovery.git
          git fetch upstream
          for branch in $(git branch -r --list 'upstream/*' | sed 's|upstream/||' | tr -d ' '); do
            if git show-ref --verify --quiet "refs/heads/$branch"; then
              git checkout "$branch"
              git merge "upstream/$branch" --no-edit
            else
              git checkout -b "$branch" "upstream/$branch"
            fi
          done

      - name: Push all branches
        run: git push --all origin
